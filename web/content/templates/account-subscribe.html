<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <title>Foundation Accelerator</title>
    <link rel="stylesheet" href="css/foundation.css" />
	<link rel="stylesheet" href="css/custom.css" />
	<link rel="stylesheet" href="css/company-profile.css" />
    <link rel="stylesheet" href="css/motion-ui.css" />
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
	<link href='css/fullcalendar.css' rel='stylesheet' />
	<link href='css/scheduler.css' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/spectrum.css">
    <link rel="stylesheet" href="js/tinymce/skins/lightgray/skin.min.css" type="text/css" />
	<script src="js/jquery.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<script src='js/moment.min.js'></script>
	<script src='js/fullcalendar.min.js'></script>
	<script src='js/scheduler.min.js'></script>
	<script src='js/jquery.tablesorter.min.js'></script>
    <script src="js/spectrum.js"></script>
    <script src="js/tinymce/tinymce.min.js"></script>
    <script src='js/setup-progress.js'></script>
    <script src='js/zen.js'></script>
    <script src="js/jquery.creditCardValidator.js"></script>
<script>
	  
$(document).ready(function() {

	$('#changeSubscription').click(changeSubscription);

	$('#closeChangeSubscription').click(closeChangeSubscription);
	$('#saveChangeSubscription').click(saveChangeSubscription);

	$('input[name="subscriptionPricingID"]').change(updatePaymentTotal);

	$('#addCCBillingAddress').click(addBillingAddress);

	$('#viewRefundPolicy').click(function(){
        $('#refundPolicy').foundation('open');
    });

	//selectedTab = '#general';
    
	//needed for Zendesk Help Ticket
	userInfo = {
	    name: "<?php echo $userFirstName;  ?>" + " <?php echo $userLastName;  ?>",
	    email: "<?php echo $userEmail;  ?>"
	}
    

	// //Change tab when hash is present in link
	// var link_tab = window.location.hash.substr(0);
	// if(link_tab){
 //   		changeTab(link_tab + 'TabLink', link_tab);
	// }

	// $('#generalTabLink').on('click', function() {
	// 	selectedTab = '#general';
	// 	confirmExit();
	// });

	// $('#servicesTabLink').on('click', function() {
	// 	selectedTab = '#services';
	// 	confirmExit();
	// });

	// $('#pricingTabLink').on('click', function() {
	// 	selectedTab = '#pricing';
	// 	confirmExit();
	// });

	// $('#contractTabLink').on('click', function() {
	// 	selectedTab = '#contract';
	// 	confirmExit();
	// });

	// $('#emailsTabLink').on('click', function() {
	// 	selectedTab = '#emails';
	// 	confirmExit();
	// });

	// $('#finalPacketTabLink').on('click', function() {
	// 	selectedTab = '#finalPacket';
	// 	confirmExit();
	// });

	
  	$('#addNewLogo').click(function(){
  		$('#newLogoUpload').show();
  		$('#addNewLogo').hide();
  	});


  	$('#editCompanyProfileModal .required').change(function(){
  		if ($(this).val != ''){
  			$(this).parent().removeClass('is-invalid-label');
			$(this).removeClass('is-invalid-input');
			$(this).parent().find('.form-error').removeClass('is-visible');
		}
  	});

  	
	$('input[required], select[required], input[name="warrantyName"], input[name="warrantyFile"], input[name="disclaimerName"], textarea[name="disclaimer"], select[name="disclaimerSection"], textarea[name="addWarrantyBody"]').change(function(){
        if ($(this).val() == ''){
            $(this).parent().addClass('is-invalid-label');
            $(this).addClass('is-invalid-input');
            $(this).parent().find('.form-error').addClass('is-visible');
        } else {
            $(this).parent().removeClass('is-invalid-label');
            $(this).removeClass('is-invalid-input');
            $(this).parent().find('.form-error').removeClass('is-visible');
        }
    });


	$('input[required], select[required]').change(function(){
        if ($(this).val() == ''){
            $(this).parent().addClass('is-invalid-label');
            $(this).addClass('is-invalid-input');
            $(this).parent().find('.form-error').addClass('is-visible');
        } else {
            $(this).parent().removeClass('is-invalid-label');
            $(this).removeClass('is-invalid-input');
            $(this).parent().find('.form-error').removeClass('is-visible');
        }
    });

	$('#CCBillingAddress input, #CCBillingAddress select').change(function(){
        $(this).parent().removeClass('is-invalid-label');
        $(this).removeClass('is-invalid-input');
        $(this).parent().find('.form-error').removeClass('is-visible');
  	});

    $('input:radio[required]').change(function(){
        if (!$('input:radio[required]').is(':checked')) {
            $('input:radio[required]').parent().addClass('is-invalid-label');
        } else {
            $('input:radio[required]').parent().removeClass('is-invalid-label');
        }
    });



	//User Color Pallette Picker
	$("#showPalette").spectrum({
		preferredFormat: "hex",
	    color: "",
	    showPaletteOnly: true,
	    hideAfterPaletteSelect:true,
	    change: function(color) {
	        var color = $("#showPalette").spectrum("get").toHexString();
			$('input[name="calendarBgColor"]').val(color);

			if (!$('.userList#0').hasClass('active')) {
				$('input[name="calendarBgColor"]').addClass('changed');
			}
	    },
	    palette: [
	    	["#000000"],

	        ["#191ab3", "#0033cc", "#0165b3", "#01989b", "#a0d3e8"],

	        ["#02b366", "#00cc00", "#33fe00", "#99fe00", "#cbff00"],

	        ["#feff00", "#ffe500", "#ffcd00", "#ffb200", "#fe9900"],

	        ["#fe8000", "#fe6600", "#ff3300", "#fd0000", "#e60065"],

	        ["#cc0099", "#970099", "#65009e", "#42009a", "#310199"]

	    ]
	});



});
//End of Document Ready

var changeSubscription = function(){

	if ('<?php echo $subscriptionPricingID;  ?>' != '') {
		$('input[name="subscriptionPricingID"][value="<?php echo $subscriptionPricingID;  ?>"]').prop('checked', true);
		updatePaymentTotal();
	}

	if ('<?php echo $subscriptionID;  ?>' != '') {
		$('.paymentArea').hide();
	}

	var pageHeight = $( window ).height() * .85;
	$('#changeSubscriptionModal').css('max-height',pageHeight)

	$('#changeSubscriptionModal').foundation('open');
};

var updatePaymentTotal = function(){
    var subscriptionPricingID = $('input[name="subscriptionPricingID"]:checked').val();

    var paymentText = $('input[name="subscriptionPricingID"]:checked').parent().parent().parent().find('h4').text();
    //var paymentTotal = $('input[name="subscriptionPricingID"]:checked').parent().parent().parent().parent().attr('data-total');

    if (subscriptionPricingID != '') {
        $('#paymentTotal').show();
        $('#paymentTotal .paymentText').text(paymentText + ' Subscription');

        //console.log(subscriptionPricingID);

        if (subscriptionPricingID == '1') {
            $('#paymentTotal .paymentBreakdown').html('Monthly Fee<br/>One Time Setup Fee<br/><br/>Due Now<br/>Next 11 Payments');
            $('#paymentTotal .paymentTotal').html('$148.00<br/>$99.00<br/><br/>$247.00<br/>$148.00');

        } else if (subscriptionPricingID == '2') {
            $('#paymentTotal .paymentBreakdown').html('One Time Setup Fee<br/><br/>Due Now');
            $('#paymentTotal .paymentTotal').html('$0.00<br/><br/>$2,178.00');   

        } else if (subscriptionPricingID == '3') {
            $('#paymentTotal .paymentBreakdown').html('Monthly Fee<br/>One Time Setup Fee<br/><br/>Due Now<br/>Next 11 Payments');
            $('#paymentTotal .paymentTotal').html('$198.00<br/>$99.00<br/><br/>$297.00<br/>$198.00');
            
        }
    }
    
};

var addBillingAddress = function () {
        
    if ($('#addCCBillingAddress').is(":checked")){
        //add validation class
        $('#CCBillingAddress').toggle();
            $('input[name="companyBillingAddress1"]').attr("required", "required");
            $('input[name="companyBillingCity"]').attr("required", "required");
            $('select[name="companyBillingState"]').attr("required", "required");
            $('input[name="companyBillingZip"]').attr("required", "required");
    } else {
        $('#CCBillingAddress').toggle();
            $('input[name="companyBillingAddress1"]').removeAttr("required");
            $('input[name="companyBillingCity"]').removeAttr("required");
            $('select[name="companyBillingState"]').removeAttr("required");
            $('input[name="companyBillingZip"]').removeAttr("required");

            //clear out the text boxes so they don't save anyway.
            $('input[name="companyBillingAddress1"]').val('');
            $('input[name="companyBillingAddress2"]').val('');
            $('input[name="companyBillingCity"]').val('');
            $('select[name="companyBillingState"]').val('');
            $('input[name="companyBillingZip"]').val('');

            //remove any validation errors if they appear
             $('#CCBillingAddress input').each(function(){
                $(this).parent().removeClass('is-invalid-label');
                $(this).removeClass('is-invalid-input');
                $(this).parent().find('.form-error').removeClass('is-visible');
             });
        
            $('#CCBillingAddress select').parent().removeClass('is-invalid-label');
            $('#CCBillingAddress select').removeClass('is-invalid-input');
            $('#CCBillingAddress select').parent().find('.form-error').removeClass('is-visible');
    }
};

var closeChangeSubscription = function(){
	$('input[name="subscriptionPricingID"]').val('');
	$('input[name="cardNumber"]').val('');
	$('input[name="expirationDate"]').val('');
	$('input[name="cardCode"]').val('');
	
 	$('input[name="companyBillingAddress1"]').val('');
    $('input[name="companyBillingAddress2"]').val('');
    $('input[name="companyBillingCity"]').val('');
    $('select[name="companyBillingState"]').val('');
    $('input[name="companyBillingZip"]').val('');

    if ($('#addCCBillingAddress').is(":checked")){
    	$('#CCBillingAddress').toggle();
    }

	$('#addCCBillingAddress').prop('checked',false);
        
    $('input[required], select[required]').parent().removeClass('is-invalid-label');
    $('input[required], select[required]').removeClass('is-invalid-input');
    $('input[required], select[required]').parent().find('.form-error').removeClass('is-visible');
    $('input[required]').parent().find('.error-match').removeClass('is-visible');
   

    $('#CCBillingAddress select').parent().removeClass('is-invalid-label');
    $('#CCBillingAddress select').removeClass('is-invalid-input');
    $('#CCBillingAddress select').parent().find('.form-error').removeClass('is-visible');

	$('#changeSubscriptionModal').foundation('close');
};

var saveChangeSubscription = function(){

	if ('<?php echo $subscriptionID;  ?>' == '') {
		$('input[required], select[required]').each(function(){
	        if ($.trim( $(this).val() ) == '') {
	        //if ($(this).val() == '') {
	            $(this).parent().addClass('is-invalid-label');
	            $(this).addClass('is-invalid-input');
	            $(this).parent().find('.form-error').addClass('is-visible');
	        } else {
	            $(this).parent().removeClass('is-invalid-label');
	            $(this).removeClass('is-invalid-input');
	            $(this).parent().find('.form-error').removeClass('is-visible');
	        }

	    });

	    if (!$('input:radio[required]').is(':checked')) {
	        $('input:radio[required]').parent().addClass('is-invalid-label');
	    } else {
	        $('input:radio[required]').parent().removeClass('is-invalid-label');
	    }


	    //if ($('input[required]').val() == '' || $('select[required]').val() == '') {
	    if ($(".is-visible")[0] || $(".is-invalid-label")[0]){
	        var registerCompanyLabels = 0;

	    } else {
	        var registerCompanyLabels = 1;
	    }
	} else {
        if (!$('input[name="subscriptionPricingID"]').is(':checked')) {
            $('input[name="subscriptionPricingID"]').parent().addClass('is-invalid-label');
            $('input[name="subscriptionPricingID"]').addClass('is-invalid-input');
            $('input[name="subscriptionPricingID"]').parent().find('.form-error').addClass('is-visible');
            var registerCompanyLabels = 0;
        } else {
            $('input[name="subscriptionPricingID"]').parent().removeClass('is-invalid-label');
            $('input[name="subscriptionPricingID"]').removeClass('is-invalid-input');
            $('input[name="subscriptionPricingID"]').parent().find('.form-error').removeClass('is-visible');
            var registerCompanyLabels = 1;
        }


	}
            
    if ('<?php echo $subscriptionID;  ?>' == '') {
	    $('input[name="cardNumber"]').validateCreditCard(function(result) {
	        //console.log(result.card_type);
	        if (result.valid == true) {
	            $('input[name="cardNumber"]').parent().find('.error-match').removeClass('is-visible');
	            registerCompanyCard = 1;
	        } else {
	            $('input[name="cardNumber"]').parent().find('.error-match').addClass('is-visible');
	            registerCompanyCard = 0;

	        }
	    });
	} else {
		var registerCompanyCard = 1;
	}


	if ('<?php echo $subscriptionID;  ?>' == '') {
		var registerCompanyCardDate = validateCreditCardDate();
    	var registerCompanyCardCode = validateCreditCardCode();
	} else {
		var registerCompanyCardDate = 1;
		var registerCompanyCardCode = 1;
	}
   

    if (registerCompanyLabels == 1 &&
        registerCompanyCard == 1 &&
        registerCompanyCardDate == 1 &&
        registerCompanyCardCode == 1) {
         	//console.log('Execute Submit');
        	$('#loading-image').show();
        	changeSubscriptionSubmit();
	}
};

var validateCreditCardDate = function(){
    var cardDate = $('input[name="expirationDate"]').val();

    if (cardDate != '') {
        if ($('input[name="expirationDate"]').val().length == 5) {
            $('input[name="expirationDate"]').parent().find('.error-match').removeClass('is-visible');

            cardDate = cardDate.split('/');

            var cardMonth = cardDate[0].trim();
            var cardYear = cardDate[1].trim();

            var currentYear = '<?php echo $currentYear; ?>'; 

            if (currentYear <= cardYear) { 
                $('input[name="expirationDate"]').parent().find('.error-match').removeClass('is-visible');

                if (cardMonth <= 12) {
                    $('input[name="expirationDate"]').parent().find('.error-match').removeClass('is-visible');
                    var registerCompany = 1;
                    return registerCompany;
                } else {
                    $('input[name="expirationDate"]').parent().find('.error-match').addClass('is-visible');
                    var registerCompany = 0;
                    return registerCompany;
                }

            }   else {
                $('input[name="expirationDate"]').parent().find('.error-match').addClass('is-visible');
                var registerCompany = 0;
                return registerCompany;
            }

        } else {
            $('input[name="expirationDate"]').parent().find('.error-match').addClass('is-visible');
            var registerCompany = 0;
            return registerCompany;
        }

    } else {
        $('input[name="expirationDate"]').parent().find('.error-match').addClass('is-visible');
        var registerCompany = 0;
        return registerCompany;
    }
    
};


var validateCreditCardCode = function(){
    var cardCode = $('input[name="cardCode"]').val();

    if (cardCode != '') {
        if ($('input[name="cardCode"]').val().length >= 3) {
            $('input[name="cardCode"]').parent().find('.error-match').removeClass('is-visible');
            var registerCompany = 1;
            return registerCompany;
        } else {
            $('input[name="cardCode"]').parent().find('.error-match').addClass('is-visible');
            var registerCompany = 0;
            return registerCompany;
        }
    } else {
        $('input[name="cardCode"]').parent().find('.error-match').addClass('is-visible');
        var registerCompany = 0;
        return registerCompany;
    }
    
};

var changeSubscriptionSubmit = function(){
    var companyID = '<?php echo $companyID;  ?>';
	var subscriptionID = '<?php echo $subscriptionID;  ?>';
	var subscriptionPricingID = $('input[name="subscriptionPricingID"]:checked').val();
    var cardNumber = $('input[name="cardNumber"]').val();
    var expirationDate = $('input[name="expirationDate"]').val();
    var cardCode = $('input[name="cardCode"]').val();
    var companyBillingAddress1 = $('input[name="companyBillingAddress1"]').val();
    var companyBillingAddress2 = $('input[name="companyBillingAddress2"]').val();
    var companyBillingCity = $('input[name="companyBillingCity"]').val();
    var companyBillingState = $('select[name="companyBillingState"]').val();
    var companyBillingZip = $('input[name="companyBillingZip"]').val();
    
    $.ajax({
        url: 'change-subscription.php',
        dataType: "json",
        contentType: 'application/json',
        type: "POST",
        contentType: "application/x-www-form-urlencoded",
        data: {
        	subscriptionID: subscriptionID,
            subscriptionPricingID: subscriptionPricingID,
            cardNumber: cardNumber,
            expirationDate: expirationDate,
            cardCode: cardCode,
            companyBillingAddress1: companyBillingAddress1,
            companyBillingAddress2: companyBillingAddress2,
            companyBillingCity: companyBillingCity,
            companyBillingState: companyBillingState,
            companyBillingZip: companyBillingZip
        },
        success: function(response) {
            //console.log(response);
            if (response == 'true') {

            	$.ajax({
                    url: 'getCompany.php',
                    dataType: "json",
                    contentType: 'application/json',
                    type: "POST",
                    contentType: "application/x-www-form-urlencoded",
                    success: function(response) {
                        //console.log(response);
                        if (response != '') {
                            window.location.href = "index.php";
                        } 
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(textStatus, errorThrown);
                        console.log(jqXHR.responseText);
                    }
                });
            	
            } else {
                $('#loading-image').hide();
                $('#errorModal p#errorMessage').text(response);
                $('#errorModal').foundation('open');
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(textStatus, errorThrown);
            console.log(jqXHR.responseText);
        }
    });
};

var changeTab = function(tabLink, tabContent ){
	$('#project-tabs li').each(function(){
		$(this).removeClass('is-active');
		$(this).find('a').removeAttr('aria-selected');
	});

	$('.tabs-content div').each(function (){
		$(this).removeClass('is-active')
	});

	$(tabContent).addClass('is-active');
	$(tabLink).parent().addClass('is-active');
	$(tabLink).attr('aria-selected', 'true');
}


var addPhoneRowCompany = function () {

    //oldRow = $('#phoneTable').find('tbody > tr:last-child input.isPrimary').attr('value');
    //var newRow = parseFloat(oldRow) + 1;

    $cloneBlankRow = $('#phoneTable').find('tbody tr:first').clone().css('display', '');
    $('#phoneTable').find('tbody').append($cloneBlankRow);
    $('#phoneTable').find('tbody > tr:last-child input.isPrimary').change(isPrimaryCheckCompany);
    $('#phoneTable').find('tbody > tr:last-child .delete > a').click(deletePhoneRowCompany);

    $('#phoneTable').find('tbody > tr:last-child input.Phone').mask('(000) 000-0000');

    //if ($('input.isPrimary').is(':not(:checked)'))
    if (!$('#phoneTable input.isPrimary:checked'))
        $('#phoneTable tbody tr:nth-child(2) td.primary input.isPrimary').prop('checked', true);
};


var deletePhoneRowCompany = function () {

	if ($(this).parent().parent().hasClass('dbRow')) {
		$(this).parent().parent().find('input').attr('delete','delete');
		$(this).parent().parent().css('display','none');

		  if ($(this).parent().parent().find('input.isPrimary').is(':checked'))
            $('#phoneTable tbody tr:visible').eq(0).find('td.primary input.isPrimary').prop('checked', true);

        if ($('#phoneTable tbody').children().length == 1)
           	addPhoneRowCompany();
	} else {
		$(this).parent().parent().remove();

		if ($(this).parent().parent().find('input.isPrimary').is(':checked'))
            $('#phoneTable tbody tr:visible').eq(0).find('td.primary input.isPrimary').prop('checked', true);

        if ($('#phoneTable tbody').children().length == 1)
           addPhoneRowCompany();
	}

};


var isPrimaryCheckCompany = function () {

    $('#phoneTable').find('input.isPrimary').prop('checked', false);
    $(this).prop('checked', true);

};


 	var editCompanyProfile = function () {
    	//Get User General Info

    	$.ajax({
			url: 'getCompany.php',
			dataType: "json",
			contentType: 'application/json',
			type: "GET",
			contentType: "application/x-www-form-urlencoded",
			success: function(response) {

          		$('input[name="companyName"]').val(response.companyName);
				$('input[name="companyAddress1"]').val(response.companyAddress1);
				$('input[name="companyAddress2"]').val(response.companyAddress2);
				$('input[name="companyCity"]').val(response.companyCity);

				if ($('select[name="companyState"]').has('option[value="' + response.companyState + '"]').length > 0)
		     		$('select[name="companyState"] > option[value="' + response.companyState + '"]').attr('selected', 'selected');

				$('input[name="companyZip"]').val(response.companyZip);

				//Billing adddress FXLRATR 350
				//Populate the edit modal form with any existing billing address information
				//if it exists
				var companyBillingAddress1=response.companyBillingAddress1;
				// if (companyBillingAddress1 != null) {
				// 	companyBillingAddress1=companyBillingAddress1.trim();
				// }

				if (companyBillingAddress1 != null)
				{
					$('#addBillingAddress').prop('checked', true);
					$('#BillingAddress').show();
					$('input[name="companyBillingAddress1"]').val(response.companyBillingAddress1);
					$('input[name="companyBillingAddress2"]').val(response.companyBillingAddress2);
					$('input[name="companyBillingCity"]').val(response.companyBillingCity);

					if ($('select[name="companyBillingState"]').has('option[value="' + response.companyBillingState + '"]').length > 0)
						$('select[name="companyBillingState"] > option[value="' + response.companyBillingState + '"]').prop('selected', 'selected');
						
						$('input[name="companyBillingZip"]').val(response.companyBillingZip);
					
					

				}else{
					$('#addBillingAddress').prop('checked', false);
					$('#BillingAddress').hide()
					$('input[name="companyBillingAddress1"]').val('');
					$('input[name="companyBillingAddress2"]').val('');
					$('input[name="companyBillingCity"]').val('');
					$('input[name="companyBillingZip"]').val('');
					$('select[name="companyBillingState"]').val();
					$('.required').parent().removeClass('is-invalid-label');
					$('.required').removeClass('is-invalid-input');
					$('.required').parent().find('.form-error').removeClass('is-visible');

				}




				$('input[name="companyWebsite"]').val(response.companyWebsite);

				$('input[name="companyColor"]').val(response.companyColor);
				$('input[name="companyColorHover"]').val(response.companyColorHover);

				$('input[name="companyEmailFrom"]').val(response.companyEmailFrom);
				$('input[name="companyEmailReply"]').val(response.companyEmailReply);

				$('input[name="defaultInvoices"]').val(response.defaultInvoices);

				if (response.invoiceSplitBidAcceptance != null) {
		     		var invoiceSplitBidAcceptance = response.invoiceSplitBidAcceptance * 100;
		     	} else {
		     		var invoiceSplitBidAcceptance = '';
		     	}

		     	if (response.invoiceSplitProjectComplete != null) {
		     		var invoiceSplitProjectComplete = response.invoiceSplitProjectComplete * 100;
		     	} else {
		     		var invoiceSplitProjectComplete = '';
		     	}
				

				$('input[name="invoiceSplitBidAcceptance"]').val(invoiceSplitBidAcceptance);
				$('input[name="invoiceSplitProjectComplete"]').val(invoiceSplitProjectComplete);


				if ($('select[name="timezone"]').has('option[value="' + response.timezone + '"]').length > 0)
		     		$('select[name="timezone"] > option[value="' + response.timezone + '"]').attr('selected', 'selected');

		     	if (response.daylightSavings == '1') {
		     	 	$('input[name="daylightSavings"]').attr('checked', 'checked');
		     	}

		     	if (response.companyLogo == null) {
		     		$('#newLogoUpload').show();
  					$('#addNewLogo').hide();
		     	} else {
		     		$('#currentLogo').html('<img style="border:1px solid #cacaca;width:8rem;" src="image.php?type=companylogo&cid='+response.companyID+'&name='+response.companyLogo+'"><br/>');
		     	}

				//Company Profile Color Picker
				$("#companyColor").spectrum({
					preferredFormat: "hex",
			   	 	showInput: true,
			   	 	change: function(color) {
				        var color = $("#companyColor").spectrum("get").toHexString();
						$('input[name="companyColor"]').val(color);
				    },
				});

				//Company Profile Color Picker
				$("#companyColorHover").spectrum({
					preferredFormat: "hex",
			   	 	showInput: true,
			   	 	change: function(color) {
				        var color = $("#companyColorHover").spectrum("get").toHexString();
						$('input[name="companyColorHover"]').val(color);
				    },
				});


				//On Success Get User Phone
                $.ajax({
					url: 'getCompanyPhone.php',
					dataType: "json",
					contentType: 'application/json',
					type: "GET",
					contentType: "application/x-www-form-urlencoded",
					success: function(response) {
						$.each(response, function (i, item) {

		              		$cloneRow = $('#phoneTable tbody tr:first').clone().css('display', '');

		              		$cloneRow.addClass('dbRow');

		                    $cloneRow.find('input.Description').val(item.phoneDescription);
		                    $cloneRow.find('input.Phone').val(item.phoneNumber);

		                     if (item.isPrimary == '1') {
		                     	$cloneRow.find('input.isPrimary').prop('checked', true);
		                     } else {
		                     	$cloneRow.find('input.isPrimary').prop('checked', false);
		                     }
		                        

		                    $cloneRow.find('input.Description').attr('sort', item.companyPhoneID);
		                    $cloneRow.find('input.Phone').attr('sort', item.companyPhoneID);
		                    $cloneRow.find('input.isPrimary').attr('sort', item.companyPhoneID);


		                    $('#editCompanyProfileModal #phoneTable tbody').append($cloneRow);
		                    $('#editCompanyProfileModal #phoneTable tbody > tr:last-child input.isPrimary ').click(isPrimaryCheckCompany);
		                    $('#editCompanyProfileModal #phoneTable tbody > tr:last-child a ').click(deletePhoneRowCompany);
		                    $('#editCompanyProfileModal #phoneTable').find('tbody > tr:last-child input.Phone').mask('(000) 000-0000');

		                });

						var pageHeight = $( window ).height() * .85;

						//On Success Display Modal
		                $('#editCompanyProfileModal').foundation('open');
		                $('#editCompanyProfileModal').css('height',pageHeight);

		                if (disableCancelButton){
		                	$('#closeEditCompanyProfile').prop('disabled',true);
		                }
		                else{
		                	$('#closeEditCompanyProfile').prop('disabled',false);
		                }

					}, error: function(jqXHR, textStatus, errorThrown) {
		  				console.log(textStatus, errorThrown);
						console.log(jqXHR.responseText);
					}

				});

			}, error: function(jqXHR, textStatus, errorThrown) {
  				console.log(textStatus, errorThrown);
				console.log(jqXHR.responseText);
			}

		});

    };


	var closeEditCompanyProfile = function() {
		$('#editCompanyProfileModal #phoneTable tbody tr').not(':first').remove();

				$('#editCompanyProfileModal #phoneTable tbody tr').not(':first').remove();

				$('input[name="companyName"]').val('');
				$('input[name="companyAddress1"]').val('');
				$('input[name="companyAddress2"]').val('');
				$('input[name="companyCity"]').val('');
				$('input[name="companyState"]').val('');
				$('input[name="companyZip"]').val('');

                //clear billing address FXLRATR350
                $('#addBillingAddress').prop('checked', false);
				$('input[name="companyBillingAddress1"]').val('');
				$('input[name="companyBillingAddress2"]').val('');
				$('input[name="companyBillingCity"]').val('');
				$('input[name="companyBillingState"]').val('');
				$('input[name="companyBillingZip"]').val('');

				$('input[name="companyWebsite"]').val('');
				$('input[name="companyColor"]').val('');
				$('input[name="companyColorHover"]').val('');
				$('input[name="companyEmailFrom"]').val('');
				$('input[name="companyEmailReply"]').val('');
				$('input[name="defaultInvoices"]').val('');
				$('input[name="invoiceSplitBidAcceptance"]').val('');
				$('input[name="invoiceSplitProjectComplete"]').val('');
				$('input[name="timezone"]').val('');
				$('input[name="daylightSavings"]').val('');
				$('input[name="companyLogo"]').val('');
		
				$('.required').parent().removeClass('is-invalid-label');
				$('.required').removeClass('is-invalid-input');
				$('.required').parent().find('.form-error').removeClass('is-visible');

				$('#companyPhoneSection small.onePhone').removeClass('is-visible');
				$('#companyPhoneSection small.fullPhone').removeClass('is-visible');
				$('#companyPhoneSection small.primary').removeClass('is-visible');

				$('#editCompanyProfileModal').foundation('close');

	};

  	var saveEditCompanyProfile = function() {

  		$('#editCompanyProfileModal .required').each(function(){
  			if ($(this).val() == '') {
	  			$(this).parent().addClass('is-invalid-label');
				$(this).addClass('is-invalid-input');
				$(this).parent().find('.form-error').addClass('is-visible');
	  		} else {
	  			$(this).parent().removeClass('is-invalid-label');
				$(this).removeClass('is-invalid-input');
				$(this).parent().find('.form-error').removeClass('is-visible');
	  		}

  		});

  		if ($('#phoneTable tbody tr:visible').length > 0) {
  			$('#companyPhoneSection small.onePhone').removeClass('is-visible');
  			
  			$('#phoneTable tbody tr:visible').each(function(){
  				if ($(this).find('td input.Phone').val() == '' || $(this).find('td input.Description').val() == '') {
                	$('#companyPhoneSection small.fullPhone').addClass('is-visible');
	            } else {
	                if ($(this).find('td input.Phone').val().length < 14) {
                         $('#companyPhoneSection small.fullPhone').addClass('is-visible');
                    } else {
                        $('#companyPhoneSection small.fullPhone').removeClass('is-visible');
                    }
	            }
  			});
        } else {
            $('#companyPhoneSection small.onePhone').addClass('is-visible');
        }

        if ($('#phoneTable .isPrimary:checked').length < 1) {
            $('#companyPhoneSection small.primary').addClass('is-visible');
            
        } else {
            if ($('#phoneTable .isPrimary:checked').is(':visible')) {
                $('#companyPhoneSection small.primary').removeClass('is-visible');
            } else {
                $('#companyPhoneSection small.primary').addClass('is-visible');
            }
        }

  	// 	if ($('#phoneTable tbody tr:last td input.Phone').val() == '') {
  	// 		$('small.onePhone').addClass('is-visible');
  	// 	} else {
  	// 		$('small.onePhone').removeClass('is-visible');
  	// 	}

  	// 	if ($('#phoneTable .isPrimary:checked').length < 1) {
  	// 		$('small.primary').addClass('is-visible');

  	// 	} else {
  	// 		if ($('#phoneTable .isPrimary:checked').is(':visible')) {
  	// 			$('small.primary').removeClass('is-visible');
			// } else {
			// 	$('small.primary').addClass('is-visible');

			// }
  	// 	}

  		if (!$('#editCompanyProfileModal .required').parent().hasClass('is-invalid-label')&&
  			!$('#companyPhoneSection small.onePhone').hasClass('is-visible') &&
  			!$('#companyPhoneSection small.primary').hasClass('is-visible')  &&
  			!$('#companyPhoneSection small.fullPhone').hasClass('is-visible')) {

  			//console.log('Save');

  			$('#loading-image').show();

  			var companyName = $('input[name="companyName"]').val();
  			var companyAddress1 = $('input[name="companyAddress1"]').val();
  			var companyAddress2 = $('input[name="companyAddress2"]').val();
  			var companyCity = $('input[name="companyCity"]').val();
  			var companyState = $('select[name="companyState"]').val();
  			var companyZip = $('input[name="companyZip"]').val();


  			// billing address FXLRATR-350
  			var companyBillingAddress1 = $('input[name="companyBillingAddress1"]').val();
  			var companyBillingAddress2 = $('input[name="companyBillingAddress2"]').val();
  			var companyBillingCity = $('input[name="companyBillingCity"]').val();
  			var companyBillingState = $('select[name="companyBillingState"]').val();
  			var companyBillingZip = $('input[name="companyBillingZip"]').val();


  			var companyWebsite = $('input[name="companyWebsite"]').val();
  			var companyColor = $('input[name="companyColor"]').val();
  			var companyColorHover = $('input[name="companyColorHover"]').val();
  			var companyEmailFrom = $('input[name="companyEmailFrom"]').val();
  			var companyEmailReply = $('input[name="companyEmailReply"]').val();
  			var defaultInvoices = $('input[name="defaultInvoices"]').val();
  			var invoiceSplitBidAcceptance = $('input[name="invoiceSplitBidAcceptance"]').val();
  			var invoiceSplitProjectComplete = $('input[name="invoiceSplitProjectComplete"]').val();
  			var timezone = $('select[name="timezone"]').val();

  			if ($('input[name="daylightSavings"]:checked').length > 0) {
  				var daylightSavings = 1;
  			} else {
  				var daylightSavings = 0;
  			}


  			invoiceSplitBidAcceptance = invoiceSplitBidAcceptance / 100;
  			invoiceSplitProjectComplete = invoiceSplitProjectComplete / 100;

			storeCompanyPhoneTableData();

			function storeCompanyPhoneTableData() {
		        var phoneTableData = new Array();
		        $('#editCompanyProfileModal #phoneTable tbody tr').each(function(row,tr){
		            phoneTableData[row]={
		            	"phoneDelete":$(tr).find('td:eq(0)').find('input').attr('delete'),
		            	"companyPhoneID":$(tr).find('td:eq(0)').find('input').attr('sort'),
		                "phoneDescription":$(tr).find('td:eq(0)').find('input').val(),
		                "phoneNumber":$(tr).find('td:eq(1)').find('input').val(),
		                "isPrimary":$(tr).find('td:eq(2)').find('input:checked').val()
		            };
		        });
		        phoneTableData.shift();
		        var companyPhoneTableArray = phoneTableData;
		        companyPhoneTableArray = JSON.stringify(companyPhoneTableArray);


		        var formdata = new FormData();
                formdata.append('companyName', companyName);
                formdata.append('companyAddress1', companyAddress1);
                formdata.append('companyAddress2', companyAddress2);
                formdata.append('companyCity', companyCity);
                formdata.append('companyState', companyState);
                formdata.append('companyZip', companyZip);

                // billing address FXLRATR350
                formdata.append('companyBillingAddress1', companyBillingAddress1);
                formdata.append('companyBillingAddress2', companyBillingAddress2);
                formdata.append('companyBillingCity', companyBillingCity);
                formdata.append('companyBillingState', companyBillingState);
                formdata.append('companyBillingZip', companyBillingZip);


                formdata.append('companyWebsite', companyWebsite);
                formdata.append('companyColor', companyColor);
                formdata.append('companyColorHover', companyColorHover);
                formdata.append('companyEmailFrom', companyEmailFrom);
                formdata.append('companyEmailReply', companyEmailReply);
                formdata.append('defaultInvoices', defaultInvoices);
                formdata.append('invoiceSplitBidAcceptance', invoiceSplitBidAcceptance);
                formdata.append('invoiceSplitProjectComplete', invoiceSplitProjectComplete);
                formdata.append('timezone', timezone);
                formdata.append('daylightSavings', daylightSavings);
                formdata.append('phoneArray', companyPhoneTableArray);
                formdata.append('file', $('#editCompanyProfileModal input[name="companyLogo"]')[0].files[0]);

		        $.ajax({
		        	url: 'company-profile-edit.php',
                    type: "POST",
                    data: formdata,
                    processData: false,  // tell jQuery not to process the data
                    contentType: false,  // tell jQuery not to set contentType
					success: function(response) {
		        		response = response.replace('"', '');
		        		response = response.replace('"', '');
						// console.log(response);
		          		if (response == 'true') {
		          			getCompanyInfo();

		          			$('#editCompanyProfileModal #phoneTable tbody tr').not(':first').remove();

							$('input[name="companyName"]').val('');
							$('input[name="companyAddress1"]').val('');
							$('input[name="companyAddress2"]').val('');
							$('input[name="companyCity"]').val('');
							$('input[name="companyState"]').val('');
							$('input[name="companyZip"]').val('');

			                //clear billing address FXLRATR350
							$('input[name="companyBillingAddress1"]').val('');
							$('input[name="companyBillingAddress2"]').val('');
							$('input[name="companyBillingCity"]').val('');
							$('input[name="companyBillingState"]').val('');
							$('input[name="companyBillingZip"]').val('');


							$('input[name="companyWebsite"]').val('');
							$('input[name="companyColor"]').val('');
							$('input[name="companyColorHover"]').val('');
							$('input[name="companyEmailFrom"]').val('');
							$('input[name="companyEmailReply"]').val('');
							$('input[name="defaultInvoices"]').val('');
							$('input[name="invoiceSplitBidAcceptance"]').val('');
							$('input[name="invoiceSplitProjectComplete"]').val('');
							$('input[name="timezone"]').val('');
							$('input[name="daylightSavings"]').val('');
							$('input[name="companyLogo"]').val('');

							$('#loading-image').hide();

							disableCancelButton = false;
		          			$('#editCompanyProfileModal').foundation('close');
						 	$('#companySuccessModal').foundation('open');
		          		} else {

		          			$('#companyErrorModal p.error-text').text(response);
						 	$('#companyErrorModal').foundation('open');
		          		}

					}, error: function(jqXHR, textStatus, errorThrown) {
		  				console.log(textStatus, errorThrown);
						console.log(jqXHR.responseText);
					}

				});

		    }
  		}

	};


	var getCompanyInfo = function() {
		//Get Company General Info
    	$.ajax({
			url: 'getCompany.php',
			dataType: "json",
			contentType: 'application/json',
			type: "GET",
			contentType: "application/x-www-form-urlencoded",
			success: function(response) {

				$('.project-title').text(response.companyName);

				$('.website').html('Website: <a href="'+response.companyWebsite+'">'+response.companyWebsite+'</a>');

				if (response.companyAddress2) { var companyAddress2 = ', ' + response.companyAddress2 }
				else { var companyAddress2 = ''; }

				$('.companyAddress').html(''+response.companyAddress1+''+companyAddress2+'<br/>'+response.companyCity+', '+response.companyState+' '+response.companyZip+'');

				//billing address FXLRATR 350
				if (response.companyBillingAddress1){

					if(response.companyBillingAddress2) 
						{ 
							var companyBillingAddress2 =', '+response.companyBillingAddress2;
						}else{
							var companyBillingAddress2 = '';
						}
					$('.companyBillingAddress').html(''+response.companyBillingAddress1+''+companyBillingAddress2+ 
						'<br/>' + response.companyBillingCity + ', ' + response.companyBillingState + ' ' + response.companyBillingZip);
				}else{
					$('.companyBillingAddress').html('-As Above-');
				}
				

				if (response.companyLogo != null) {
					$('.companyLogo').html('<img src="image.php?type=companylogo&cid='+response.companyID+'&name='+response.companyLogo+'" style="width:10rem;" />');

					if ($('.companyLogo span.noPhoto').length > 0) {
						$('.companyLogo span.noPhoto').remove();
					}
				}

				$('.companyColor span').css('background',response.companyColor);
				$('.companyColorHover span').css('background',response.companyColorHover);

				$('.fromAddress').text(response.companyEmailFrom);
				$('.replyAddress').text(response.companyEmailReply);

				$('.defaultInvoices').text(response.defaultInvoices);

				var invoiceSplitBidAcceptance = response.invoiceSplitBidAcceptance * 100;
				var invoiceSplitProjectComplete = response.invoiceSplitProjectComplete * 100;
				$('.invoiceBidAcceptance').text(invoiceSplitBidAcceptance+'%');
				$('.invoiceProjectComplete').text(invoiceSplitProjectComplete+'%');

				if (response.timezone == '-18000') {
					$('.timezone').text('Eastern Time Zone');

				} else if (response.timezone == '-21600') {
					$('.timezone').text('Central Time Zone');

				} else if (response.timezone == '-25200') {
					$('.timezone').text('Mountain Time Zone');

				} else if (response.timezone == '-28800') {
					$('.timezone').text('Pacific Time Zone');

				} else if (response.timezone == '-32400') {
					$('.timezone').text('Alaska Time Zone');

				} else if (response.timezone == '-36000') {
					$('.timezone').text('Hawaii Time Zone');

				} else {
					$('.timezone').text('');
				}


				if (response.daylightSavings == 1) {
					$('.daylightSavings').text('Yes');

				} else {
					$('.daylightSavings').text('No');

				}


				//On Success Get Company Phone
                $.ajax({
					url: 'getCompanyPhone.php',
					dataType: "json",
					contentType: 'application/json',
					type: "GET",
					contentType: "application/x-www-form-urlencoded",
					success: function(response) {
						$('.companyPhones').empty();
						$.each(response, function (i, item) {

							if (item.isPrimary == 1) {
								$('.companyPhones').append(''+item.phoneDescription+': '+item.phoneNumber+'<span style="font-size:.7rem;font-style:italic;color:#999999;"> primary</span><br/>');
							} else {
								$('.companyPhones').append(''+item.phoneDescription+': '+item.phoneNumber+'<br/>');
							}
		                });

					}, error: function(jqXHR, textStatus, errorThrown) {
		  				console.log(textStatus, errorThrown);
						console.log(jqXHR.responseText);
					}

				});

			}, error: function(jqXHR, textStatus, errorThrown) {
  				console.log(textStatus, errorThrown);
				console.log(jqXHR.responseText);
			}

		});
	};

</script>
</head>
  <body>
	<div id="loading-image" class="loadingImage" style="display: none">
        <img src="images/ajax-loader.gif" />
    </div>
    <div class="row expanded" style="background-color:#f6f7fb;">
     	<div class="medium-12 columns">
      		<div class="medium-12 columns">
        		<h1 class="project-title"><?php echo $companyName;  ?></h1>
        	</div>
      	</div>
   	</div>
    <div class="row expanded" style="margin-bottom: 4rem;">
     	<div class="medium-12 columns no-pad">
      		<!-- <ul class="tabs" id="project-tabs">
  				<li style="width:16.66%" class="tabs-title is-active"><a aria-selected="true" id="generalTabLink">Subscription</a></li>
              	<li style="width:16.66%" class="tabs-title"><a id="servicesTabLink">Services &amp; Bid</a></li>
             	<li style="width:16.66%" class="tabs-title"><a id="pricingTabLink">Pricing</a></li>
              	<li style="width:16.66%" class="tabs-title"><a id="contractTabLink">Contract</a></li>
              	<li style="width:16.66%" class="tabs-title"><a id="emailsTabLink">Emails</a></li>
              	<li style="width:16.66%" class="tabs-title"><a id="finalPacketTabLink">Final Packet</a></li>
			</ul> -->
          	<div class="tabs-content" data-tabs-content="project-tabs">
  				<div class="tabs-panel is-active" id="general">
                  	<div class="row expanded">
                  		<div class="medium-4 columns">
                    		<div class="row" style="margin:0 1.5rem 4rem 1.5rem;">
                            	<div class="medium-12 columns">
                    				<h4>Company Subscription</h4>
                 				</div>
                 				<div class="medium-12 columns" style="margin-bottom: 2rem;">
	                                <?php echo $subscriptionDisplay;  ?>
	                 			</div>
                 			</div>
			   			</div>
          			</div>
          			<div class="row expanded" style="position: absolute;bottom:0;">
				        <div class="small-12 columns">  
				        	<div class="row" style="margin:0 1.5rem 4rem 1.5rem;">
                            	<div class="medium-12 columns">
						            <a id="viewRefundPolicy">Refund Policy</a><br/>
						             <!-- (c) 2005, 2016. Authorize.Net is a registered trademark of CyberSource Corporation --> 
						            <div class="AuthorizeNetSeal" style="float: left;"> 
						                <script type="text/javascript" language="javascript">var ANS_customer_id="aca1ca9a-a2b7-4a07-a554-d0288519bee9";</script> 
						                <script type="text/javascript" language="javascript" src="//verify.authorize.net/anetseal/seal.js" ></script> 
						                <a href="http://www.authorize.net/" id="AuthorizeNetText" target="_blank">Merchant Services</a> 
						            </div>
						        </div>
						    </div>
				        </div>
				        <div class="reveal small" id="refundPolicy" data-reveal data-close-on-esc="false" data-close-on-click="false">
				            <h3 class="text-center">Refund Policy</h3>
				            <div class="row">
				                <div class="medium-12 columns">
				                    <ul>
				                        <li>Cancel at any time</li>
				                        <li>Subscription will not be renewed if cancelled.  E.g. If your subscription is monthly and you cancel you can access the system for the remainder of that month.  When your cancellation becomes effective, you will no longer be billed for the service or have access to your account.</li>
				                        <li>If your payment fails for any reason, you will not be able to access your account until your account is current.</li>
				                        <li>All Subscriptions are automatically renewed unless cancelled.</li>
				                    </ul>
				                    <p class="text-center no-margin">
				                        <button class="button" data-close>OK</button>
				                    </p> 
				                </div>
				            </div>
				        </div>
				    </div>
          			<div class="reveal small" id="changeSubscriptionModal" data-reveal data-close-on-esc="false" data-close-on-click="false">
 						<h3 class="text-center">Subscription</h3>
 						<h5>Choose Subscription</h5>
 						<div class="row align-center" style="margin-bottom: 1rem;">
		                    <div class="medium-4 columns" data-total="247.00">
		                        <p style="color:#2089ca;margin-bottom:0rem;">&nbsp;</p>
		                        <div class="callout">
		                            <h4 class="text-center">Monthly</h4>
		                            <h5 class="text-center" style="margin-bottom:0;">$148/month</h5>
		                            <p class="no-margin text-center">
		                                <br/>
		                                <span style="color:#2089ca;font-size: 1rem;font-style: normal;">Includes 2 Users</span><br/>
		                                $24 Each Additional User<br/> 
		                                Monthly Subscription<br/>
		                                $99 Set Up Fee<br/><br/><br>
		                                <label>
		                                    <input name="subscriptionPricingID" type="radio" value="1" required />
		                                    Monthly
		                                </label>
		                            </p>
		                        </div>
		                    </div>
		                    <div class="medium-4 columns" data-total="2,178.00">
		                        <p class="text-center" style="color:#2089ca;margin-bottom:0rem;"><strong>BEST DEAL!</strong></p>
		                        <div class="callout" style="border: 2px solid #2089C9;">
		                            <h4 class="text-center">Annual</h4>
		                            <h5 class="text-center" style="margin-bottom:0;">$198/month</h5>
		                            <p class="no-margin text-center">
		                                <span>$2,001 Total Savings</span><br/>
		                                <span style="color:#2089ca;font-size: 1rem;font-style: normal;">Includes 10 Users</span><br/>
		                                $24 Each Additional User<br/>
		                                <strong>Includes 1 Month Free</strong><br/>
		                                Annual Subscription<br/>
		                                <s>$99 Set Up Fee</s><br/><br/>
		                                <label>
		                                    <input name="subscriptionPricingID" type="radio" value="2" required />
		                                    Annual
		                                </label>
		                            </p>
		                        </div>
		                    </div> 
		                    <div class="medium-4 columns" data-total="198.00">
		                        <p style="color:#2089ca;margin-bottom:0rem;">&nbsp;</p>
		                        <div class="callout">
		                            <h4 class="text-center">Annual (Monthly)</h4>
		                            <h5 class="text-center" style="margin-bottom:0;">$198/month</h5>
		                            <p class="no-margin text-center">
		                                <br/>
		                                <span style="color:#2089ca;font-size: 1rem;font-style: normal;">Includes 10 Users</span><br/>
		                                $24 Each Additional User<br/>
		                                Annual Subscription<br/>
		                                $99 Set Up Fee<br/><br/><br>
		                                <label>
		                                    <input name="subscriptionPricingID" type="radio" value="3" required />
		                                    Annual Billed Monthly
		                                </label>
		                            </p>
		                        </div>
		                    </div> 
		                </div>
		                <h5 class="paymentArea">Payment Information</h5>
		                <div class="row paymentArea">
		                    <div class="small-6 columns">
		                        <label>
		                            Card Number <small>required</small>
		                            <input name="cardNumber" type="text" value="" required="">
		                            <small class="form-error">Card Number is required.</small>
		                            <small class="error-match">Card Number is invalid.</small>
		                        </label>
		                    </div>
		                </div>
		                <div class="row paymentArea">
		                    <div class="small-3 columns">
		                        <label>
		                            Expiration Date <small>required</small>
		                            <input name="expirationDate" class="expiration" type="text" value="" required="">
		                            <small class="form-error">Expiration Date is required.</small>
		                            <small class="error-match">Date is invalid.</small>
		                        </label>
		                    </div>
		                    <div class="small-3 columns">
		                        <label>
		                            Code on Back of Card <small>required</small>
		                            <input name="cardCode" class="cardCode" type="text" value="" required="">
		                            <small class="form-error">3 digit code is required.</small>
		                            <small class="error-match">Code is invalid.</small>
		                        </label>
		                    </div>
		                </div>
		                <div class="row paymentArea" style="margin:.5rem 0 1rem 0;">
		                    <div class="large-10 columns">
		                        <label>
		                            <input type="checkBox" id="addCCBillingAddress">Is credit card billing address different than your company address on file?
		                        </label>
		                    </div>
		                </div>
		                <div class="row paymentArea" id="CCBillingAddress" style="display: none; margin: 0rem 0 1.5rem 1rem">
		                    <div class="medium-6 columns">
		                        <label>Billing Address 
		                            <small>(Street Address, P.O. Box) required</small>
		                            <input name="companyBillingAddress1" type="text" value="">
		                            <small class="form-error">Billing Address is required.</small>
		                        </label>
		                    </div>
		                    <div class="medium-4 columns">
		                        <label>Billing Address 2 
		                            <small>(Apt, Suite, Unit)</small>
		                            <input name="companyBillingAddress2" type="text" value="">
		                        </label>
		                    </div>
		                    <div class="medium-4 columns">
		                        <label>Billing City 
		                            <input name="companyBillingCity" type="text" value="">
		                            <small class="form-error">Billing City is required.</small>
		                        </label>
		                    </div>
		                    <div class="medium-3 columns">
		                        <label>Billing State 
		                            <select  name="companyBillingState">
		                                <?php echo $stateOptions;  ?>                          
		                            </select>
		                            <small class="form-error">Billing State is required.</small>
		                        </label>
		                    </div>
		                    <div class="medium-3 columns">
		                        <label>Billing Zip 
		                            <input name="companyBillingZip" type="text" value="">
		                            <small class="form-error">Billing Zip is required.</small>
		                        </label>
		                    </div>
		                </div>
		                <div id="paymentTotal" class="callout primary" style="margin: 0rem 0 1.5rem 0; display: none;">
		                    <h5>Payment Total</h5>
		                    <p class="no-margin paymentText">
		                        Subscription
		                    </p>
		                    <div class="row">
		                        <div class="medium-10 columns">
		                            <p class="text-right paymentBreakdown">
		                                
		                            </p>
		                        </div>
		                        <div class="medium-2 columns">
		                            <p class="text-right paymentTotal">
		                                
		                            </p>
		                        </div>
		                    </div>
		                </div>
		                <div class="row">
			        		<div class="medium-12 columns">
			            		<p class="text-center no-margin">
			             			<button class="button" id="saveChangeSubscription">Save</button>
			                  		<button class="button secondary" id="closeChangeSubscription">Cancel</button>
			             		</p>
			          		</div>
			       		</div>
      				</div>
      				<div class="tiny reveal" id="errorModal" data-reveal>
	                    <h3 class="text-center">Error</h3>
	                    <div class="row">
	                        <div class="medium-12 columns">
	                            <p id="errorMessage" class="text-center">
	                                
	                            </p>
	                            <p class="text-center no-margin">
	                                <button class="button" data-close>OK</button>
	                            </p> 
	                        </div>
	                    </div>
	                </div>
         		</div>
        	</div>
      	</div>
   	</div>

<script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
    <script type="text/javascript" src="js/jquery.mask.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $('.Phone').mask('(000) 000-0000');
            $('.date').mask('11/11/1111');
            $('.expiration').mask('00/00');
            $('.cardCode').mask('0000');
            $('.time').mask('Hh:Mm Pp',
               {
                   'translation': {
                       H: { pattern: /[0-1]/ },
                       h: { pattern: /[0-9]/ },
                       M: { pattern: /[0-5]/ },
                       m: { pattern: /[0-9]/ },
                       P: { pattern: /[AaPp]/ },
                       p: { pattern: /[Mm]/ }
                   }
               });
        });

    </script>
  </body>
</html>
